<!DOCTYPE html>
<html>
	<head>		
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="css/datepicker.css">
		<link rel="stylesheet" type="text/css" href="css/cD.css">
		<link rel="stylesheet" href="fonts/font-awesome/css/font-awesome.min.css">
		
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.22/require.min.js"></script>
		<script type="text/javascript">
			require.config({
				baseUrl: 'js',
				paths: {
					'jquery': ['http://code.jquery.com/jquery-1.9.1.min'],
					'jquery-ui': ['lib/jquery-ui.min'],
					'knockout': ['http://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min'],
					'bootstrap': ['https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min'],
					'bootstrap-datepicker': 'lib/bootstrap-datepicker',
					'cwrc-api': 'cwrc-api',
					'cwrcDialogs': 'cD'
				},
				shim: {
					'jquery-ui': ['jquery'],
					'bootstrap': ['jquery', 'jquery-ui'],
					'bootstrap-datepicker': ['bootstrap']
				}
			});
			
			require(['cwrcDialogs'], function(cD) {
				// set the BASE URL to the Entity API for loading/saving/creating/searching
				cD.setCwrcApi('http://cwrc-dev-01.srv.ualberta.ca/islandora/cwrc_entities/v1/');
				// set the BASE URL of the source object link in the search information boxes
				cD.setRepositoryBaseObjectURL('http://cwrc-dev-01.srv.ualberta.ca/islandora/object/');
				// set Schemas
				cD.setPersonSchema("http://cwrc.ca/schemas/entities.rng");
				cD.setOrganizationSchema("http://cwrc.ca/schemas/entities.rng");
				cD.setPlaceSchema("http://cwrc.ca/schemas/entities.rng");
				// set URL from the outside linked data sources 
				cD.setGeonameUrl("http://cwrc-dev-01.srv.ualberta.ca/cwrc-mtp/geonames/");
				cD.setViafUrl("http://cwrc-dev-01.srv.ualberta.ca/services/viaf/");
				cD.setGoogleGeocodeUrl("http://maps.googleapis.com/maps/api/geocode/xml");

				$("#addPerson").click(function(){
					$("#entityXMLContainer").text("");
					var opts = {
						success: function(result) {
							if(result.response.error){
								alert(result.response.error);
								$("#entityXMLContainer").text("");
							}else{
								if (result.response !== undefined && result.response.pid !== undefined)
								{
								  $("#resultHeader").text("Person entity " + result.response.pid);
								  $("#entityXMLContainer").text(result.data);
								}
								else
								{
								  alert(result.response.message);
								  $("#resultHeader").text(result.response.message);
								}

							}
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						startValue : $("#startValuePerson").val()
					};
					cD.popCreatePerson(opts);
				});

				$("#addOrganization").click(function(){
					$("#resultHeader").text("Entity ");
					$("#entityXMLContainer").text("");
					var opts = {
						success: function(result) {
							if(result.response.error){
								alert(result.response.error);
								$("#entityXMLContainer").text("");
							}else{
								if (result.response !== undefined && result.response.pid !== undefined)
								{
								  $("#resultHeader").text("Organization entity " + result.response.pid);
								  $("#entityXMLContainer").text(result.data);
								}
								else
								{
								  alert(result.response.message);
								  $("#resultHeader").text(result.response.message);
								}
							}
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						startValue : $("#startValueOrganization").val()
					};
					cD.popCreateOrganization(opts);
				});

				$("#addPlace").click(function(){
					$("#resultHeader").text("Entity ");
					$("#entityXMLContainer").text("");
					var opts = {
						success: function(result) {
							if(result.response.error){
								alert(result.response.error);
								$("#entityXMLContainer").text("");
							}else{
								if (result.response !== undefined && result.response.pid !== undefined)
								{
								  $("#resultHeader").text("Place entity " + result.response.pid);
								  $("#entityXMLContainer").text(result.data);
								}
								else
								{
								  alert(result.response.message);
								  $("#resultHeader").text(result.response.message);
								}
							}
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						startValue : $("#startValuePlace").val()
					};
					cD.popCreatePlace(opts);
				});

				$("#addTitle").click(function(){
					$("#resultHeader").text("Entity ");
					$("#entityXMLContainer").text("");
					var opts = {
						success: function(result) {
							if(result.response.error){
								alert(result.response.error);
								$("#entityXMLContainer").text("");
							}else{
								if (result.response !== undefined && result.response.pid !== undefined)
								{
								  $("#resultHeader").text("Title entity " + result.response.pid);
								  $("#entityXMLContainer").text(result.data);
								}
								else
								{
								  alert(result.response.message);
								  $("#resultHeader").text(result.response.message);
								}
							}
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						startValue : $("#startValueTitle").val()
					};
					cD.popCreateTitle(opts);
				});


				$("#searchPerson").click(function(){
					$("#resultHeader").text("Entity ");
					$("#entityXMLContainer").text("");

					var customAction = function(data) {

						var result = "";
						for (var i in data) {
							if (data.hasOwnProperty(i)) {
								result += i + " : " + data[i] + "	";
							}
						}

						$("#resultHeader").text("Result");
						$("#entityXMLContainer").text(result);
					};

					var opts = {
						success: function(result) {
							$("#resultHeader").text("Added");
							$("#entityXMLContainer").text(JSON.stringify(result));
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						buttons : [
							{
								label : "Show response",
								isEdit : false,
								action : customAction
							},
							{
								label : "Create",
								isEdit : false,
								action : cD.popCreatePerson
							},
							{
								label : "Edit",
								isEdit : true,
								action : cD.popEditPerson
							}
								
						],
						query : $("#startValuePerson").val()
					}

					cD.popSearchPerson(opts);
				});


				$("#searchOrganization").click(function(){
					$("#resultHeader").text("Organization ");
					$("#entityXMLContainer").text("");

					var opts = {
						success: function(result) {
							$("#resultHeader").text("Added");
							$("#entityXMLContainer").text(JSON.stringify(result));
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						buttons : [				
							{
								label : "Create",
								isEdit : false,
								action : cD.popCreateOrganization
							},
							{
								label : "Edit",
								isEdit : true,
								action : cD.popEditOrganization
							},
								
						],
						query : $("#startValueOrganization").val()
					}

					cD.popSearchOrganization(opts);
				});

				$("#searchPlace").click(function(){
					$("#resultHeader").text("Place ");
					$("#entityXMLContainer").text("");

					var opts = {
						success: function(result) {
							$("#resultHeader").text("Added");
							$("#entityXMLContainer").text(JSON.stringify(result));
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						buttons : [				
							{
								label : "Create",
								isEdit : false,
								action : cD.popCreatePlace
							},
							{
								label : "Edit",
								isEdit : true,
								action : cD.popEditPlace
							},
								
						],
						query : $("#startValuePlace").val()
					}

					cD.popSearchPlace(opts);
				});

				$("#searchTitle").click(function(){
					$("#resultHeader").text("Title ");
					$("#entityXMLContainer").text("");

					var opts = {
						success: function(result) {
							$("#resultHeader").text("Added");
							$("#entityXMLContainer").text(JSON.stringify(result));
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						buttons : [
							{
								label : "Create",
								isEdit : false,
								action : cD.popCreateTitle
							},
							{
								label : "Edit",
								isEdit : true,
								action : cD.popEditTitle
							},
								
						],
						query : $("#startValueTitle").val()
					}

					cD.popSearchTitle(opts);
				});

				$("#searchCustomButton").click(function(){

					var searchName = $("#customSearchSelectionButton").text();
					var searchType = searchName.toLowerCase().trim();
					var searchQuery = $("#searchPersonInput").val();

					$("#resultHeader").text(searchName + " ");
					$("#entityXMLContainer").text("");

					var opts = {
						success: function(result) {
							$("#resultHeader").text("Added");
							$("#entityXMLContainer").text(JSON.stringify(result));
						},
						error : function(errorThrown) {
							$("#entityXMLContainer").text("");
							$("#resultHeader").text("Entity ");
						},
						buttons : [
							{
								label : "Edit",
								isEdit : true,
								action : cD.popEdit[searchType]
							},
								
						],
						query : searchQuery
					}

					cD.popSearch[searchType](opts)

				});


				$('#customSearchSelection li > a').click(function(e){
					$("#customSearchSelectionButton").html(this.innerHTML + ' <span class="caret"></span>');
				});



				$("#clear-button").click(function(){
					$("#entityXMLContainer").text("");
					$("#resultHeader").text("Entity ");
				});

			
			});
		</script>
		
	</head>
	<body class="bootstrap-scope">
		<div class="container">
			<h1>Entity dialog test</h1>
			<hr>				

			<div class="row">
				<div class="col-md-6">

					<form class="form-horizontal" role="form">
					<div class="form-group">
						<!-- <label class="col-md-3 control-label">Person</label>	 -->				
						<input type="text" id="startValuePerson" placeholder="Person">
						<button id="searchPerson" type="button" class="btn btn-default"><i class="fa fa-search"></i></button>
						<button id="addPerson" type="button" class="btn btn-default"><i class="fa fa-plus"></i></button>						
					</div>
					<div  class="form-group">
						<!-- <label class="col-md-3 control-label">Organization</label> -->
						<input type="text" id="startValueOrganization" placeholder="Organization">
						<button id="searchOrganization" type="button" class="btn btn-default"><i class="fa fa-search"></i></button>
						<button id="addOrganization" type="button" class="btn btn-default"><i class="fa fa-plus"></i></button>						
					</div>
					<div  class="form-group">
						<!-- <label class="col-md-3 control-label">Place</label> -->
						<input type="text" id="startValuePlace" placeholder="Place">
						<button id="searchPlace" type="button" class="btn btn-default"><i class="fa fa-search"></i></button>
						<button id="addPlace" type="button" class="btn btn-default"><i class="fa fa-plus"></i></button>						
					</div>
					<div  class="form-group">
						<!-- <label class="col-md-3 control-label">Title</label> -->
						<input type="text" id="startValueTitle" placeholder="Title">
						<button id="searchTitle" type="button" class="btn btn-default"><i class="fa fa-search"></i></button>
						<button id="addTitle" type="button" class="btn btn-default"><i class="fa fa-plus"></i></button>						
					</div>


					<div  class="form-group">
						<div class="input-group">


							<div class="input-group-btn">
        						<button type="button"  id="customSearchSelectionButton" class="btn btn-default dropdown-toggle btnStatus" data-toggle="dropdown">Person <span class="caret"></span></button>
        						<ul class="dropdown-menu" id="customSearchSelection">
          							<li><a href="#">Person</a></li>
						        	<li><a href="#">Organization</a></li>
						          	<li><a href="#">Place</a></li>
						          	<li><a href="#">Title</a></li>
						        </ul>
      						</div>

							<input type="text" class="form-control" id="searchPersonInput" placeholder="Search">
							<span class="input-group-btn">
								<button id="searchCustomButton" type="button" class="btn btn-default"><i class="fa fa-search"></i></button>
							</span>
						</div>
					</div>

				</form>

				</div>
				<div class="col-md-6">
					
					<div class="panel panel-default">
						<div class="panel-heading">
							<div class="row">
								<div class="col-md-10">
									<h5 id="resultHeader">Entity</h5>
								</div>
																
								<div class="col-md-2">
									<button id="clear-button" class="btn btn-danger">Clear</button>
								</div>
							</div>
						</div>
						<div class="panel-body" id="entityXMLContainer">						
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
